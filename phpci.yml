build_settings:
    ignore:
        - "vendor"
        - "tests"
    mysql:
        host: "localhost"
        user: "root"
        pass: "root"

setup:
    shell:
        - "perl ../../addHost.pl `echo ${PWD##*/}`"
        - "service apache2 restart"
        - "chmod -R a+rwx ./"
        - "echo DROP DATABASE IF EXISTS `echo ${PWD##*/}` | mysql -uroot -hlocalhost -proot"
        - "echo CREATE DATABASE `echo ${PWD##*/}` | mysql -uroot -hlocalhost -proot"
        - "mysql -uroot -hlocalhost -proot `echo ${PWD##*/}` < ./db.dump"
        - "cat src/engine/config.php | sed -e \"s/flight.base_url.*/flight.base_url', '`echo ${PWD##*/}`');/\" | sed -e \"s/dbname=.*/dbname=`echo ${PWD##*/}`', 'root', 'root'));/\" > src/engine/config.php"
    mysql:
        - "DROP DATABASE IF EXISTS test;"
        - "CREATE DATABASE test;"

test:
    php_cs_fixer:
        verbose: true
        diff: true
        level: "psr2"
        workingdir: "./src"
    php_mess_detector:
        path: "./src"
        allow_failures: true
    php_code_sniffer:
        path: "/src"
        standard: "PSR2"
    php_docblock_checker:
        path: "./src"
    php_cpd:
        path: "./src"
        allow_failures: true
    php_loc:
        directory: "./src"

complete:
    slack_notify:
        webhook_url: "https://hooks.slack.com/services/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"
        room: "#phpci"
        username: "PHPCI"
        icon: ":ghost:"
        message: "%PROJECT_TITLE% - build %BUILD% completed"
        show_status: true
    mysql:
        host: "localhost"
        user: "root"
        pass: "root"
    mysql:
        - "DROP DATABASE IF EXISTS test;"
